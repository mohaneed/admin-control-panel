{% extends "layouts/base.twig" %}

{% block title %}Sessions | {{ ui.appName }}
{% endblock %}

{% block content %}
	<div class="flex flex-wrap items-center justify-between gap-3 ">
		<h2 class="text-xl font-semibold text-gray-800">Sessions</h2>
		<nav>
			<ol class="flex items-center gap-1.5">
				<li>
					<a class="inline-flex items-center gap-1.5 text-sm text-gray-500" href="{{ ui.adminUrl }}dashboard">
						Home
						<svg class="stroke-current" width="17" height="16" viewbox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M6.0765 12.667L10.2432 8.50033L6.0765 4.33366" stroke="" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"></path>
						</svg>
					</a>
				</li>
				<li class="text-sm text-gray-800">Sessions</li>
			</ol>
		</nav>
	</div>
    {# ‚úÖ Inject capabilities for JavaScript #}
    {#
    Capabilities are computed server-side by AuthorizationService
    and control what UI elements are visible/enabled.

    Available capabilities:
    - can_revoke_bulk: Show "Revoke" button in actions (POST /api/sessions/revoke-bulk)
    - can_revoke_id: Show "revoke" button within table in actions (POST /api/sessions/{session_id})
    - can_view_admin: Show "Link" button within table in actions (GET /admins/{id}/profile)

    UI Rules:
    ‚ùå Twig MUST NOT check permissions by name
    ‚ùå JavaScript MUST NOT infer authorization
    ‚úÖ Backend capabilities are the single UI contract
    ‚úÖ API authorization is always enforced server-side
    #}
    <script>
        window.sessionsCapabilities = {
            can_view_admin: {{ capabilities.can_view_admin ?? false ? 'true' : 'false' }},
            can_revoke_id: {{ capabilities.can_revoke_id ?? false ? 'true' : 'false' }},
            can_revoke_bulk: {{ capabilities.can_revoke_bulk ?? false ? 'true' : 'false' }},
        };
        console.log('üîê Sessions Capabilities Injected:', window.sessionsCapabilities);
    </script>

    <div class=" px-0 py-2">
		<!-- Header -->


		

		<!-- Description -->


		<!-- Search Section -->
		<div class="bg-white rounded-lg shadow border border-gray-200 mb-6">
			<div class="px-2 py-4">
				<form
					id="sessions-search-form" class="grid grid-cols-1 md:grid-cols-4 gap-4">
					<!-- Session ID Filter -->
					<div>
						<label for="filter-session-id" class="block text-sm font-medium text-gray-700 mb-1">
							Session ID
						</label>
						<input type="text" id="filter-session-id" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Search by ID fragment">
					</div>

					<!-- Admin Filter -->
					<div>
						<label for="filter-admin-id" class="block text-sm font-medium text-gray-700 mb-1">
							Filter by Admin
						</label>
						<input type="text" id="filter-admin-id" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Search by Admin id">
					</div>

					<!-- Status Filter -->
					<div>
						<label for="filter-status" class="block text-sm font-medium text-gray-700 mb-1">
							Status
						</label>
						<select id="filter-status" class="w-full px-3 py-2 border bg-white border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
							<option value="">All</option>
							<option value="active">Active</option>
							<option value="revoked">Revoked</option>
							<option value="expired">Expired</option>
						</select>
					</div>

					<!-- Action Buttons -->
					<div class="flex items-end space-x-1">
						<button type="submit" class="text-xs px-4 py-1 bg-blue-600 text-white rounded-md hover:bg-white hover:text-blue-600 border  hover:border-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
							Search
						</button>
						<button type="button" id="btn-reset" class="text-xs px-4 py-1 bg-white text-gray-600 border border-gray-600 rounded-md hover:bg-gray-600 hover:text-white focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
							Reset
						</button>
						{# ‚úÖ Show "Revoke" button only if user has can_revoke_bulk capability #}
						{# NOTE: This capability should be provided by the backend. If missing, add it to AuthorizationService #}
						{% if capabilities.can_revoke_bulk ?? false %}
						<button class="text-xs px-4 py-1 bg-white text-red-600 border border-red-600 rounded-md hover:bg-red-600 hover:text-white transition-all duration-300 cursor-not-allowed opacity-50" id="btn-bulk-revoke" disabled>
							Revoke (<span id="selected-count" class="font-semibold">0</span>)
						</button>
						{% endif %}
					</div>
				</form>
			</div>
		</div>



<div class="container mt-6"> <div id="table-container" class="w-full"></div>
	</div>

{% endblock %}

{% block scripts %}
<script src="{{ asset('assets/js/callback_handler.js') }}"></script>
<script src="{{ asset('assets/js/useInputChecker.js') }}"></script>
<script src="{{ asset('assets/js/data_table.js') }}"></script>
<script src="{{ asset('assets/js/pages/sessions.js') }}"></script>
	
{% endblock %}