{% extends "layouts/base.twig" %}

{# =========================
   Recursive Metadata Macro
   ========================= #}
{% macro render_metadata(data) %}
    {% for key, value in data %}
        <tr class="border-t">
            <td class="px-4 py-2 align-top font-medium text-gray-700">
                {{ key }}
            </td>
            <td class="px-4 py-2">
                {% if value is iterable %}
                    <table class="min-w-full border border-gray-200 mt-2 text-sm">
                        <tbody>
                        {{ _self.render_metadata(value) }}
                        </tbody>
                    </table>
                {% else %}
                    <span class="break-all text-gray-700">{{ value }}</span>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
{% endmacro %}

{% block title %}
    Telemetry Metadata
{% endblock %}

{% block content %}

    <!-- Header + Breadcrumb -->
    <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
        <h2 class="text-xl font-semibold text-gray-800">
            Telemetry Metadata
        </h2>

        <nav>
            <ol class="flex items-center gap-1.5">
                <li>
                    <a class="inline-flex items-center gap-1.5 text-sm text-gray-500" href="{{ ui.adminUrl }}dashboard">
                        Home
                    </a>
                </li>
                <li>
                    <a class="inline-flex items-center gap-1.5 text-sm text-gray-500" href="{{ ui.adminUrl }}telemetry">
                        Telemetry
                    </a>
                </li>
                <li class="text-sm text-gray-800">
                    Metadata
                </li>
            </ol>
        </nav>
    </div>

    <!-- Event Information -->
    <div class="bg-white rounded-lg shadow border border-gray-200 mb-6">
        <div class="px-4 py-4">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Event Information</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div><strong>ID:</strong> {{ telemetry.id }}</div>
                <div><strong>Event Key:</strong> {{ telemetry.eventKey }}</div>
                <div><strong>Severity:</strong> {{ telemetry.severity }}</div>
                <div><strong>Occurred At:</strong> {{ telemetry.occurredAt }}</div>
            </div>
        </div>
    </div>

    <!-- Actor Information -->
    <div class="bg-white rounded-lg shadow border border-gray-200 mb-6">
        <div class="px-4 py-4">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Actor</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div><strong>Actor Type:</strong> {{ telemetry.actorType }}</div>
                <div><strong>Actor ID:</strong> {{ telemetry.actorId }}</div>
            </div>
        </div>
    </div>

    <!-- Request Information -->
    <div class="bg-white rounded-lg shadow border border-gray-200 mb-6">
        <div class="px-4 py-4">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Request</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div><strong>Route Name:</strong> {{ telemetry.routeName }}</div>
                <div><strong>Request ID:</strong> {{ telemetry.requestId }}</div>
                <div><strong>IP Address:</strong> {{ telemetry.ipAddress }}</div>
                <div class="md:col-span-2">
                    <strong>User Agent:</strong>
                    <div class="break-all text-gray-700 mt-1">
                        {{ telemetry.userAgent }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Metadata -->
    <div class="bg-white rounded-lg shadow border border-gray-200">
        <div class="px-4 py-4">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Metadata</h3>

            <div class="overflow-x-auto">
                <table class="min-w-full border border-gray-200 text-sm">
                    <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-2 text-left border-b">Key</th>
                        <th class="px-4 py-2 text-left border-b">Value</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% if metadata is empty %}
                        <tr>
                            <td colspan="2" class="px-4 py-4 text-center text-gray-500">
                                No metadata recorded
                            </td>
                        </tr>
                    {% else %}
                        {{ _self.render_metadata(metadata) }}
                    {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

{% endblock %}

{% block scripts %}
    {# No JS needed for this page #}
{% endblock %}
