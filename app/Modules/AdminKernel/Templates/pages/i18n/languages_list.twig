{% extends "layouts/base.twig" %}

{% block title %}
    Languages | {{ ui.appName }}
{% endblock %}

{% block content %}
    <!-- Page Header + Breadcrumb -->
    <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
        <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-100">ğŸŒ Languages Management</h2>

        <nav>
            <ol class="flex items-center gap-1.5">
                <li>
                    <a
                            class="inline-flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
                            href="{{ ui.adminUrl }}dashboard"
                    >
                        Home
                        <svg class="stroke-current" width="17" height="16" viewBox="0 0 17 16" fill="none"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M6.0765 12.667L10.2432 8.50033L6.0765 4.33366"
                                  stroke=""
                                  stroke-width="1.2"
                                  stroke-linecap="round"
                                  stroke-linejoin="round"/>
                        </svg>
                    </a>
                </li>
                <li class="text-sm text-gray-800 dark:text-gray-200">Languages</li>
            </ol>
        </nav>
    </div>

    {# ============================================================
       ğŸ” Capabilities Injection (UI Contract)
       ------------------------------------------------------------
       - Capabilities are computed server-side by AuthorizationService
       - Twig MUST NOT check permissions by name
       - JavaScript MUST NOT infer authorization
       - API authorization is always enforced server-side

       Available capabilities (per I18N_LANGUAGES_UI.md contract):
       - can_create         â†’ Create new language
       - can_update         â†’ Update language settings (direction/icon)
       - can_update_name    â†’ Update language name
       - can_update_code    â†’ Update language code
       - can_update_sort    â†’ Update sort order (reposition)
       - can_active         â†’ Activate / deactivate language
       - can_fallback_set   â†’ Set fallback language
       - can_fallback_clear â†’ Clear fallback language
       ============================================================ #}

    <script>
        window.languagesCapabilities = {
            can_create        : {{ capabilities.can_create         ?? false ? 'true' : 'false' }},
            can_update        : {{ capabilities.can_update         ?? false ? 'true' : 'false' }},
            can_update_name   : {{ capabilities.can_update_name    ?? false ? 'true' : 'false' }},
            can_update_code   : {{ capabilities.can_update_code    ?? false ? 'true' : 'false' }},
            can_update_sort   : {{ capabilities.can_update_sort    ?? false ? 'true' : 'false' }},
            can_active        : {{ capabilities.can_active         ?? false ? 'true' : 'false' }},
            can_fallback_set  : {{ capabilities.can_fallback_set   ?? false ? 'true' : 'false' }},
            can_fallback_clear: {{ capabilities.can_fallback_clear ?? false ? 'true' : 'false' }}
        };

        console.log('ğŸ” Languages Capabilities Injected:', window.languagesCapabilities);
    </script>

    <!-- Page Body -->
    <div class="px-0 py-2">
        <div class="container mt-6">
            {# ============================================================
               ğŸ” Search & Filters Section
               ============================================================ #}
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
                <form id="languages-filter-form" class="space-y-4">
                    {# Column Filters #}
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {# ID Filter - NEW #}
                        <div>
                            <label for="filter-id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                ğŸ†” Language ID
                            </label>
                            <input
                                    type="number"
                                    id="filter-id"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all dark:placeholder-gray-400"
                                    placeholder="e.g., 1, 2, 3..."
                                    min="1"
                            />
                        </div>

                        <div>
                            <label for="filter-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                ğŸ“ Language Name
                            </label>
                            <input
                                    type="text"
                                    id="filter-name"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all dark:placeholder-gray-400"
                                    placeholder="e.g., English, Arabic..."
                            />
                        </div>

                        <div>
                            <label for="filter-code" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                ğŸ·ï¸ Language Code
                            </label>
                            <input
                                    type="text"
                                    id="filter-code"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all dark:placeholder-gray-400"
                                    placeholder="e.g., en, ar, fr..."
                                    maxlength="5"
                            />
                        </div>

                        <div>
                            <label for="filter-direction" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                â†”ï¸ Text Direction
                            </label>
                            <select
                                    id="filter-direction"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                            >
                                <option value="">All Directions</option>
                                <option value="ltr">LTR (Left to Right)</option>
                                <option value="rtl">RTL (Right to Left)</option>
                            </select>
                        </div>

                        <div>
                            <label for="filter-status" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                ğŸ“Š Status
                            </label>
                            <select
                                    id="filter-status"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                            >
                                <option value="">All Statuses</option>
                                <option value="1">Active</option>
                                <option value="0">Inactive</option>
                            </select>
                        </div>
                    </div>

                    {# Action Buttons #}
                    <div class="flex flex-wrap gap-3 pt-4">
                        <button
                                type="submit"
                                class="px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            Search
                        </button>

                        <button
                                type="button"
                                id="btn-reset"
                                class="px-6 py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium flex items-center gap-2"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            Reset
                        </button>

                        {# Create Language Button (Shown only if can_create capability exists) #}
                        {% if capabilities.can_create %}
                            <button
                                    type="button"
                                    id="btn-create-language"
                                    class="ml-auto px-6 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center gap-2"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                                Create Language
                            </button>
                        {% endif %}
                    </div>
                </form>
            </div>

            {# ============================================================
               ğŸ“‹ Languages Table Container (Rendered by JS)
               ============================================================ #}

            {# Global Search Bar (Above Table) #}
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-4">
                <div class="flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input
                            type="text"
                            id="languages-search"
                            class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all dark:placeholder-gray-400"
                            placeholder="ğŸ” Quick search by name or code (e.g., English, ar, French...)"
                    />
                    <button
                            type="button"
                            id="languages-search-btn"
                            class="px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
                    >
                        Search
                    </button>
                    <button
                            type="button"
                            id="languages-clear-search"
                            class="px-6 py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium"
                    >
                        Clear
                    </button>
                </div>
            </div>

            {# Data Table #}
            <div id="table-container" class="w-full"></div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {# Shared infrastructure scripts #}
    <script src="{{ asset('assets/maatify/admin-kernel/js/api_handler.js') }}"></script>
    <script src="{{ asset('assets/maatify/admin-kernel/js/callback_handler.js') }}"></script>
    <script src="{{ asset('assets/maatify/admin-kernel/js/Input_checker.js') }}"></script>
    <script src="{{ asset('assets/maatify/admin-kernel/js/data_table.js') }}"></script>

    {# âœ¨ Select2 - Custom dropdown with search #}
    <script src="{{ asset('assets/maatify/admin-kernel/js/select2.js') }}"></script>

    {# âœ¨ Project-wide reusable UI components library #}
    <script src="{{ asset('assets/maatify/admin-kernel/js/admin-ui-components.js') }}"></script>

    {# Languages-specific helpers #}
    <script src="{{ asset('assets/maatify/admin-kernel/js/pages/languages-helpers.js') }}"></script>

    {# Languages management scripts (OPTIMIZED VERSION) #}
    <script src="{{ asset('assets/maatify/admin-kernel/js/pages/languages-with-components.js') }}"></script>
    <script src="{{ asset('assets/maatify/admin-kernel/js/pages/languages-modals.js') }}"></script>
    <script src="{{ asset('assets/maatify/admin-kernel/js/pages/languages-actions.js') }}"></script>
    <script src="{{ asset('assets/maatify/admin-kernel/js/pages/languages-fallback.js') }}"></script>
{% endblock %}
