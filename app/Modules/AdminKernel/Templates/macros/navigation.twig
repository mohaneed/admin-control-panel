{% macro render(items, level = 0) %}
    <ul class="{{ level == 0 ? 'space-y-2 px-4 mt-5' : 'ml-6 mt-1 space-y-1' }} ">
        {% for item in items %}
            <li>
                {% if item.children %}
                    {# Group Item - Unified styling for both with/without path #}
                    <div onclick="toggleNav(this)" class="
                        flex items-center gap-1 p-2 rounded-md cursor-pointer
                        hover:bg-gray-100 dark:hover:bg-gray-700 
                        {{ level == 0 ? 'text-gray-900 dark:text-gray-100' : 'text-sm text-gray-700 dark:text-gray-300' }}
                    ">
                        {% if item.path %}
                            <a href="{{ item.path }}" 
                               onclick="event.stopPropagation()"
                               class="flex items-center gap-2 flex-1 font-semibold">
                                {{ item.icon|raw }}
                                <span class="flex-1 li-name custom">
                                    {{ item.title }}
                                    <span class="text-xs mx-3 text-gray-400 dark:text-gray-500">{{ item.children|length }}</span>
                                </span>
                            </a>
                        {% else %}
                            <div class="flex items-center gap-2 flex-1 font-semibold">
                                {% if item.icon %}
                                    {{ item.icon|raw }}
                                {% endif %}
                                <span class="flex-1 li-name">
                                    {{ item.title }}
                                    <span class="text-xs text-gray-400 dark:text-gray-500">{{ item.children|length }}</span>
                                </span>
                            </div>
                        {% endif %}
                        
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2"
                             stroke="currentColor" class="size-4 transition-transform duration-200 arrow">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5"/>
                        </svg>
                    </div>

                    {# Recursive Children with Toggle #}
                    <div class="nav-children overflow-hidden overflow-y-auto transition-all duration-300 rounded-md hidden max-h-96"
                         style="max-height: 0;">
                        {{ _self.render(item.children, level + 1) }}
                    </div>

                {% else %}
                    {# Leaf Link Item #}
                    <div class="">

                        <a href="{{ item.path }}" class="
								                          flex items-center gap-1 p-2 rounded-md   hover:bg-gray-100 dark:hover:bg-gray-700 {{ level == 0
                        ? 'text-gray-900 dark:text-gray-100'
                        : 'text-sm text-gray-700 dark:text-gray-300' }}">
                            {{ item.icon|raw }}
                            <span class="li-name">{{ item.title }}</span>
                        </a>
                    </div>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    {% if level == 0 %}
        <script>
            function toggleNav(element) {
                const parent = element.closest('li');
                const childrenContainer = parent.querySelector('.nav-children');
                const chevron = element.querySelector('.arrow');

                if (childrenContainer.style.maxHeight === '0px' || childrenContainer.classList.contains('hidden')) {
                    childrenContainer.classList.remove('hidden');
                    // Set max-height to scrollHeight for smooth animation
                    childrenContainer.style.maxHeight = childrenContainer.scrollHeight + 'px';

                    chevron.classList.add('rotate-180');
                } else {
                    childrenContainer.style.maxHeight = '0px';
                    chevron.classList.remove('rotate-180');
                    setTimeout(() => {
                        childrenContainer.classList.add('hidden');
                    }, 300);
                }
            }
        </script>
    {% endif %}
{% endmacro %}
